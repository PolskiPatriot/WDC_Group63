<!DOCTYPE html>
<html lang="en">
<head>
    <title>Home Page</title>
    <link rel="stylesheet" href="/stylesheets/header.css">
    <link rel="stylesheet" href="/stylesheets/13.css">
    <script src="https://cdn.jsdelivr.net/npm/ncrypt-js@1.1.0/dist/ncrypt.min.js"></script>
    <script src="https://accounts.google.com/gsi/client" async></script>
</head>
<body id="content">
    <iframe class="headerIframe" title="header" name="header" id="header" src="header.html" width="100%" height="120px"></iframe>
    <iframe class="headerIframe" title="dropdown" name="dropdown" id="dropdown" src="dropdown.html" width="315px" height="460px"></iframe>
    <div id="app" class="row">
        <div class="column" id="leftColumn"></div>
        <div class="column" id="middleColumn">
            <h1>Sign Up</h1>
            <div class="textInputs">
                <div class="nameInput">
                    <input type="text" class="barInput" placeholder="First Name" id="firstName" />
                    <input type="text" class="barInput" placeholder="Last Name" id="lastName" />
                </div>
                <input type="text" class="barInput" placeholder="Email" id="email" />
                <input type="password" class="barInput" placeholder="Password" id="password" />
                <input type="password" class="barInput" placeholder="Confirm Password" id="confirmPassword" />
            </div>
            <div class="loginButtons">
                <button type="button" class="inputLogin" onclick="signUp()">SIGN UP</button>
            </div>
            <div class="textInputs">
                <div id="g_id_onload"
                    data-client_id="119246077266-568pi1sojct64fdrvn10enalph5aqgg3.apps.googleusercontent.com"
                    data-context="signin"
                    data-ux_mode="popup"
                    data-callback="google_callback"
                    data-itp_support="true">
                </div>
                <div class="g_id_signin"
                    data-type="standard"
                    data-shape="rectangular"
                    data-theme="filled_blue"
                    data-text="signin_with"
                    data-size="large"
                    data-logo_alignment="left">
                </div>
            </div>
        </div>
        <div class="column" id="rightColumn"></div>
    </div>

    <script>
        window.onload = function () {
            google.accounts.id.initialize({
                client_id: '119246077266-568pi1sojct64fdrvn10enalph5aqgg3.apps.googleusercontent.com',
                callback: google_callback
            });
            google.accounts.id.prompt();
        };

        function google_callback(response) {
            const responsePayload = decodeJwtResponse(response.credential);
            console.log("ID: " + responsePayload.sub);
            console.log('Full Name: ' + responsePayload.name);
            console.log('Given Name: ' + responsePayload.given_name);
            console.log('Family Name: ' + responsePayload.family_name);
            console.log("Email: " + responsePayload.email);
            fetch('/google-signup', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    token: response.credential
                })
            })
            .then(response => response.text())
            .then(data => {
                alert(data);
            })
            .catch(error => {
                console.error("There was an error!", error);
            });
        }

        function decodeJwtResponse(token) { // Got this from https://stackoverflow.com/questions/38552003/how-to-decode-jwt-token-in-javascript-without-using-a-library
            var base64Url = token.split('.')[1];
            var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
            var jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
                return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
            }).join(''));

            return JSON.parse(jsonPayload);
        }

        function signUp() {
            const firstName = document.getElementById('firstName').value;
            const lastName = document.getElementById('lastName').value;
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirmPassword').value;

            if (password !== confirmPassword) {
                alert('Passwords do not match');
                return;
            }

            fetch('/signup', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    firstName: firstName,
                    lastName: lastName,
                    email: email,
                    password: password
                })
            })
            .then(response => response.text())
            .then(data => {
                alert(data);
            })
            .catch(error => {
                console.error("There was an error", error);
            });
        }
    </script>
</body>
</html>


